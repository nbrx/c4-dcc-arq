@startuml
set separator none
title Software Difusión de Contenidos - Deployment - Live

top to bottom direction

!include <C4/C4>
!include <C4/C4_Context>
!include <C4/C4_Container>
!include <C4/C4_Deployment>

Deployment_Node(Live.DCC, "DCC", $tags="") {
  Deployment_Node(Live.DCC.DataCenterRegion1, "Data Center Region 1", $tags="") {
    Deployment_Node(Live.DCC.DataCenterRegion1.DNS, "DNS", $descr="", $tags="")
    Deployment_Node(Live.DCC.DataCenterRegion1.LoadBalancer, "Load Balancer", $descr="", $tags="")
    Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado, "Nodos de Auto Escalado", "K8S", $tags="") {
      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, "Ingress Controller", $descr="", $tags="")
      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.Egress, "Egress", $descr="", $tags="")
      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.WebApp, "WebApp", "NGINX", $tags="") {
        Container(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.WebApp.SitioWebPublico_1, "Sitio Web Publico", "nextjs", "", $tags="")
      }

      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoStaticResources, "Nodo Static Resources", "NGINX", $tags="") {
        Container(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoStaticResources.CDNcontenidoestático_1, "CDN contenido estático", "cdn", $tags="")
      }

      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoBackend, "Nodo Backend", "NodeJS", $tags="") {
        Container(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoBackend.Backend_1, "Backend", "Software Difusión de Contenido", $tags="")
      }

      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoAPIGateway, "Nodo API Gateway", "KONG", $tags="") {
        Container(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoAPIGateway.Gateway_1, "Gateway", "", $tags="")
      }

      Deployment_Node(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoNatsJetStream, "Nodo Nats JetStream", "Nats JetStream", $tags="") {
        ContainerQueue(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoNatsJetStream.Messagepubsub_1, "Message pubsub", "NAT JetStream", "Cola de mensajeria del software de difusión de contenido", $tags="")
      }

    }

    Deployment_Node(Live.DCC.DataCenterRegion1.DBMSCluster, "DBMS Cluster", $tags="") {
      Deployment_Node(Live.DCC.DataCenterRegion1.DBMSCluster.PostgreSQL, "PostgreSQL", $tags="") {
        ContainerDb(Live.DCC.DataCenterRegion1.DBMSCluster.PostgreSQL.DBMSDifusióndeContenidos_1, "DBMS Difusión de Contenidos", "", $tags="")
      }

    }

  }

}

Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.WebApp.SitioWebPublico_1, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoStaticResources.CDNcontenidoestático_1, "referencia recursos estaticos", "https", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoAPIGateway.Gateway_1, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoBackend.Backend_1, "Consume Servicio Backend SDC", "service", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.WebApp.SitioWebPublico_1, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoAPIGateway.Gateway_1, "Consume Servicio API SDC", "broker", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoBackend.Backend_1, Live.DCC.DataCenterRegion1.DBMSCluster.PostgreSQL.DBMSDifusióndeContenidos_1, "Lee y escribe esquma SDC", "repository", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoNatsJetStream.Messagepubsub_1, Live.DCC.DataCenterRegion1.DBMSCluster.PostgreSQL.DBMSDifusióndeContenidos_1, "recibe replica u-proyectos", "pubsub", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.DNS, Live.DCC.DataCenterRegion1.LoadBalancer, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.LoadBalancer, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.Egress, Live.DCC.DataCenterRegion1.DNS, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.LoadBalancer, Live.DCC.DataCenterRegion1.DBMSCluster.PostgreSQL.DBMSDifusióndeContenidos_1, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.WebApp.SitioWebPublico_1, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoStaticResources.CDNcontenidoestático_1, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoAPIGateway.Gateway_1, "", $tags="")
Rel_D(Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.IngressController, Live.DCC.DataCenterRegion1.NodosdeAutoEscalado.NodoNatsJetStream.Messagepubsub_1, "", $tags="")

SHOW_LEGEND(true)
@enduml